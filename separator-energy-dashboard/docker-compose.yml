# =============================================================================
# docker-compose.yml — Separator Energy Cost Dashboard (POC)
# Driftwood Dairy | El Monte, CA | Texas Automation Systems
#
# Single container — FastAPI serves both the API and React frontend.
# Uses host networking so it can reach TimeBase at 192.254.155.2.
#
# Import separator-dashboard-v2.21.tar in Portainer Images, then
# deploy this as a Portainer Stack.
#
# Dashboard: http://<host>:3030
# =============================================================================

version: '3.8'

services:
  separator-dashboard:
    image: separator-dashboard:v2.21
    container_name: separator-dashboard
    restart: unless-stopped
    network_mode: host
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
    environment:
      - TIMEBASE_HOST=192.254.155.2
      - TIMEBASE_PORT=4511
      - TIMEBASE_DATASET=Driftwood Historian
      - FACILITY_TIMEZONE=US/Pacific
      - DEFAULT_RATE_PER_KWH=0.30
      - VOLTAGE=460
      - POWER_FACTOR=0.88
      - LOOKBACK_DAYS=7
      - MIN_GOOD_QUALITY=192
      - TOU_SUMMER_ON_PEAK=0.38
      - TOU_SUMMER_MID_PEAK=0.28
      - TOU_SUMMER_OFF_PEAK=0.18
      - TOU_WINTER_MID_PEAK=0.30
      - TOU_WINTER_OFF_PEAK=0.22
      - TOU_WINTER_SUPER_OFF_PEAK=0.16
      - TZ=America/Los_Angeles
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3030/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
